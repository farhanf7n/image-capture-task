<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css"
    />

    <style>
      .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.8);
        /* Makes the overlay darker */
      }

      * {
        margin: 0;
        padding: 0;
      }

      html {
        height: 100%;
      }

      /*Background color*/
      #grad1 {
        background: lightgrey;
        background-image: linear-gradient(120deg, #ff4081, #81d4fa);
      }

      /*form styles*/
      #msform {
        text-align: center;
        position: relative;
        margin-top: 20px;
      }

      .previewContainer img {
        /* width: 250px !important; */
        width: 100% !important;
        /* height: 300px !important; */
      }

      #msform fieldset .form-card {
        background: white;
        border: 0 none;
        border-radius: 10px;
        border: 1px solid rgb(100, 100, 100);
        box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
        padding: 20px 40px 30px 40px;
        box-sizing: border-box;
        width: 94%;
        margin: 0 3% 20px 3%;

        /*stacking fieldsets above each other*/
        position: relative;
      }

      #msform fieldset {
        background: white;
        border: 0 none;
        border-radius: 0.5rem;
        box-sizing: border-box;
        width: 100%;
        margin: 0;
        /* padding-bottom: 20px; */

        /*stacking fieldsets above each other*/
        position: relative;
      }

      /*Hide all except first fieldset*/
      #msform fieldset:not(:first-of-type) {
        display: none;
      }

      #msform fieldset .form-card {
        text-align: left;
        color: #9e9e9e;
      }

      #msform input,
      #msform textarea {
        padding: 0px 8px 4px 8px;
        border: none;
        border-bottom: 1px solid #ccc;
        border-radius: 0px;
        margin-bottom: 25px;
        margin-top: 2px;
        width: 100%;
        box-sizing: border-box;
        font-family: montserrat;
        color: #2c3e50;
        font-size: 16px;
        letter-spacing: 1px;
      }

      #msform input:focus,
      #msform textarea:focus {
        -moz-box-shadow: none !important;
        -webkit-box-shadow: none !important;
        box-shadow: none !important;
        border: none;
        font-weight: bold;
        border-bottom: 2px solid skyblue;
        outline-width: 0;
      }

      /*Blue Buttons*/
      #msform .action-button {
        width: 100px;
        background: skyblue;
        font-weight: bold;
        color: white;
        border: 0 none;
        border-radius: 0px;
        cursor: pointer;
        padding: 10px 5px;
        margin: 10px 5px;
      }

      #msform .action-button:hover,
      #msform .action-button:focus {
        box-shadow: 0 0 0 2px white, 0 0 0 3px skyblue;
      }

      /*Previous Buttons*/
      #msform .action-button-previous {
        width: 100px;
        background: #616161;
        font-weight: bold;
        color: white;
        border: 0 none;
        border-radius: 0px;
        cursor: pointer;
        padding: 10px 5px;
        margin: 10px 5px;
      }

      #msform .action-button-previous:hover,
      #msform .action-button-previous:focus {
        box-shadow: 0 0 0 2px white, 0 0 0 3px #616161;
      }

      /*Dropdown List Exp Date*/
      select.list-dt {
        border: none;
        outline: 0;
        border-bottom: 1px solid #ccc;
        padding: 2px 5px 3px 5px;
        margin: 2px;
      }

      select.list-dt:focus {
        border-bottom: 2px solid skyblue;
      }

      /*The background card*/
      .card {
        z-index: 0;
        border: none;
        border-radius: 0.5rem;
        position: relative;
        /* border: 1px solid rgb(100, 100, 100) */
      }

      .card h2 {
        margin-top: -12px;
      }

      /*FieldSet headings*/
      .fs-title {
        font-size: 25px;
        color: #2c3e50;
        margin-bottom: 10px;
        font-weight: bold;
        text-align: left;
      }

      /*progressbar*/
      #progressbar {
        margin-bottom: 16px;
        overflow: hidden;
        color: lightgrey;
        margin-top: -23px;
      }

      #progressbar .active {
        color: #000000;
      }

      #progressbar li {
        list-style-type: none;
        font-size: 12px;
        width: 25%;
        float: left;
        position: relative;
      }

      /*Icons in the ProgressBar*/
      #progressbar #document:before {
        font-family: FontAwesome;
        content: "\f023";
      }

      #progressbar #selfie:before {
        font-family: FontAwesome;
        content: "\f007";
      }

      #progressbar #fingerprint:before {
        font-family: FontAwesome;
        content: "\f09d";
      }

      #progressbar #confirm:before {
        font-family: FontAwesome;
        content: "\f00c";
      }

      /*ProgressBar before any progress*/
      #progressbar li:before {
        width: 50px;
        height: 50px;
        line-height: 45px;
        display: block;
        font-size: 18px;
        color: #ffffff;
        background: lightgray;
        border-radius: 50%;
        margin: 0 auto 10px auto;
        padding: 2px;
      }

      /*ProgressBar connectors*/
      #progressbar li:after {
        content: "";
        width: 100%;
        height: 2px;
        background: lightgray;
        position: absolute;
        left: 0;
        top: 25px;
        z-index: -1;
      }

      /*Color number of the step and the connector before it*/
      #progressbar li.active:before,
      #progressbar li.active:after {
        background: skyblue;
      }

      /*Imaged Radio Buttons*/
      .radio-group {
        position: relative;
        margin-bottom: 25px;
      }

      .radio {
        display: inline-block;
        width: 204;
        height: 104;
        border-radius: 0;
        background: lightblue;
        box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
        box-sizing: border-box;
        cursor: pointer;
        margin: 8px 2px;
      }

      .radio:hover {
        box-shadow: 2px 2px 2px 2px rgba(0, 0, 0, 0.3);
      }

      .radio.selected {
        box-shadow: 1px 1px 2px 2px rgba(0, 0, 0, 0.1);
      }

      /*Fit image in bootstrap div*/
      .fit-image {
        width: 100%;
        object-fit: cover;
      }

      #cameraContainer {
        position: relative;
        /* width: 300px; */
        width: auto;
        /* Adjust according to your layout */
        /* height: 200px; */
        height: auto;
        /* Adjust according to your layout */
      }

      #videoFeed {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .btn-sm {
        font-size: 12px;
      }

      #captureButton {
        position: absolute;
        bottom: -24px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 13px;
      }

      .retake_btn {
        display: flex;
        justify-content: center;
        align-content: center;
      }

      #retakebutton {
        margin-right: 3px;
      }

      #next_step {
        margin-left: 3px;
      }

      #loader {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        /* Semi-transparent background */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        /* Ensure it's on top of all other elements */
      }

      .spinner {
        border: 16px solid #f3f3f3;
        border-top: 16px solid #3498db;
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      #content {
        /* Hide content until loader is removed */
        display: none;
      }

      @media only screen and (max-width: 426px) {
        .card h2 {
          font-size: 20px;
        }

        .card p {
          font-size: 12px;
        }

        .form-card h4 {
          font-size: 20px;
        }
      }

      @media only screen and (max-width: 376px) {
        .card h2 {
          font-size: 20px;
        }

        .card p {
          font-size: 12px;
        }

        .form-card h4 {
          font-size: 17px;
        }
      }

      @media only screen and (max-width: 321px) {
        .card h2 {
          font-size: 20px;
        }

        .card p {
          font-size: 10px;
        }

        .form-card h4 {
          font-size: 14px;
        }

        #captureButton {
          font-size: 11px;
        }
      }
    </style>
    <meta name="csrf-token" content="" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="{{ asset('assets/js/jquery.validate.min.js') }}"></script>
  </head>

  <body id="grad1">
    <div id="loader">
      <div class="spinner"></div>
      <p>Loading..</p>
    </div>
    <!-- MultiStep Form -->
    <div class="container-fluid" id="">
      <div class="row justify-content-center mt-0">
        <div
          class="col-11 col-sm-9 col-md-7 col-lg-6 text-center p-0 mt-0 mb-0"
        >
          <div class="card px-0 pt-4 pb-0 mt-3 mb-3">
            <h2><strong>Identity Verification</strong></h2>
            <p>Please complete all steps to proceed.</p>
            <div class="row">
              <div class="col-md-12 mx-0">
                <style>
                  .modal-backdrop {
                    width: 0 !important;
                  }

                  .error {
                    color: red;
                  }

                  #overlayCanvas {
                    position: absolute;
                    top: -5px !important;
                    left: 0;
                    width: 100%;
                    height: 100%;
                  }
                </style>
                <form id="msform">
                  <ul id="progressbar">
                    <li class="active" id="document">
                      <strong>ID Card</strong>
                    </li>
                    <li id="document"><strong>ID Card</strong></li>
                    <li id="selfie"><strong>Selfie</strong></li>

                    <li id="confirm"><strong>Fingerprint</strong></li>
                  </ul>
                  <fieldset>
                    <div class="form-card">
                      <h4>Front Side</h4>
                      <p>
                        Upload your ID Card front side.please make sure that the
                        document should be clear and readable.
                      </p>
                      <div class="box_btn">
                        <div id="cameraContainer">
                          <video id="videoFeed" autoplay playsinline></video>
                          <canvas id="overlayCanvas"></canvas>
                          <button
                            id="captureButton"
                            class="btn btn-primary btn-sm"
                          >
                            Capture Image
                          </button>
                        </div>
                        <div
                          class="previewContainer"
                          id="previewContainer"
                        ></div>
                        <span
                          class="error"
                          style="color: red"
                          id="error_cnic_document"
                        ></span>
                      </div>
                      <div class="retake_btn">
                        <button
                          class="btn btn-danger btn-sm mt-2"
                          style="display: none"
                          id="retakebutton"
                        >
                          Retake
                        </button>
                        <button
                          class="btn btn-primary btn-sm mt-2"
                          style="display: none"
                          id="next_step"
                        >
                          Next Step
                        </button>
                      </div>
                    </div>
                  </fieldset>
                </form>

                <div
                  class="modal fade"
                  id="documentVerification"
                  tabindex="-1"
                  role="dialog"
                  aria-labelledby="modalLabel"
                  aria-hidden="true"
                  data-keyboard="false"
                  data-backdrop="static"
                >
                  <!DOCTYPE html>
                  <html lang="en">
                    <head>
                      <meta charset="UTF-8" />
                      <meta
                        name="viewport"
                        content="width=device-width, initial-scale=1.0"
                      />
                      <meta http-equiv="X-UA-Compatible" content="ie=edge" />
                      <title>Document</title>
                      <link
                        rel="stylesheet"
                        href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
                      />

                      <link
                        rel="stylesheet"
                        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css"
                      />

                      <style>
                        .modal-backdrop {
                          background-color: rgba(0, 0, 0, 0.8);
                          /* Makes the overlay darker */
                        }

                        * {
                          margin: 0;
                          padding: 0;
                        }

                        html {
                          height: 100%;
                        }

                        /*Background color*/
                        #grad1 {
                          background: lightgrey;
                          background-image: linear-gradient(
                            120deg,
                            #ff4081,
                            #81d4fa
                          );
                        }

                        /*form styles*/
                        #msform {
                          text-align: center;
                          position: relative;
                          margin-top: 20px;
                        }

                        .previewContainer img {
                          /* width: 250px !important; */
                          width: 100% !important;
                          /* height: 300px !important; */
                        }

                        #msform fieldset .form-card {
                          background: white;
                          border: 0 none;
                          border-radius: 10px;
                          border: 1px solid rgb(100, 100, 100);
                          box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
                          padding: 20px 40px 30px 40px;
                          box-sizing: border-box;
                          width: 94%;
                          margin: 0 3% 20px 3%;

                          /*stacking fieldsets above each other*/
                          position: relative;
                        }

                        #msform fieldset {
                          background: white;
                          border: 0 none;
                          border-radius: 0.5rem;
                          box-sizing: border-box;
                          width: 100%;
                          margin: 0;
                          /* padding-bottom: 20px; */

                          /*stacking fieldsets above each other*/
                          position: relative;
                        }

                        /*Hide all except first fieldset*/
                        #msform fieldset:not(:first-of-type) {
                          display: none;
                        }

                        #msform fieldset .form-card {
                          text-align: left;
                          color: #9e9e9e;
                        }

                        #msform input,
                        #msform textarea {
                          padding: 0px 8px 4px 8px;
                          border: none;
                          border-bottom: 1px solid #ccc;
                          border-radius: 0px;
                          margin-bottom: 25px;
                          margin-top: 2px;
                          width: 100%;
                          box-sizing: border-box;
                          font-family: montserrat;
                          color: #2c3e50;
                          font-size: 16px;
                          letter-spacing: 1px;
                        }

                        #msform input:focus,
                        #msform textarea:focus {
                          -moz-box-shadow: none !important;
                          -webkit-box-shadow: none !important;
                          box-shadow: none !important;
                          border: none;
                          font-weight: bold;
                          border-bottom: 2px solid skyblue;
                          outline-width: 0;
                        }

                        /*Blue Buttons*/
                        #msform .action-button {
                          width: 100px;
                          background: skyblue;
                          font-weight: bold;
                          color: white;
                          border: 0 none;
                          border-radius: 0px;
                          cursor: pointer;
                          padding: 10px 5px;
                          margin: 10px 5px;
                        }

                        #msform .action-button:hover,
                        #msform .action-button:focus {
                          box-shadow: 0 0 0 2px white, 0 0 0 3px skyblue;
                        }

                        /*Previous Buttons*/
                        #msform .action-button-previous {
                          width: 100px;
                          background: #616161;
                          font-weight: bold;
                          color: white;
                          border: 0 none;
                          border-radius: 0px;
                          cursor: pointer;
                          padding: 10px 5px;
                          margin: 10px 5px;
                        }

                        #msform .action-button-previous:hover,
                        #msform .action-button-previous:focus {
                          box-shadow: 0 0 0 2px white, 0 0 0 3px #616161;
                        }

                        /*Dropdown List Exp Date*/
                        select.list-dt {
                          border: none;
                          outline: 0;
                          border-bottom: 1px solid #ccc;
                          padding: 2px 5px 3px 5px;
                          margin: 2px;
                        }

                        select.list-dt:focus {
                          border-bottom: 2px solid skyblue;
                        }

                        /*The background card*/
                        .card {
                          z-index: 0;
                          border: none;
                          border-radius: 0.5rem;
                          position: relative;
                          /* border: 1px solid rgb(100, 100, 100) */
                        }

                        .card h2 {
                          margin-top: -12px;
                        }

                        /*FieldSet headings*/
                        .fs-title {
                          font-size: 25px;
                          color: #2c3e50;
                          margin-bottom: 10px;
                          font-weight: bold;
                          text-align: left;
                        }

                        /*progressbar*/
                        #progressbar {
                          margin-bottom: 16px;
                          overflow: hidden;
                          color: lightgrey;
                          margin-top: -23px;
                        }

                        #progressbar .active {
                          color: #000000;
                        }

                        #progressbar li {
                          list-style-type: none;
                          font-size: 12px;
                          width: 25%;
                          float: left;
                          position: relative;
                        }

                        /*Icons in the ProgressBar*/
                        #progressbar #document:before {
                          font-family: FontAwesome;
                          content: "\f023";
                        }

                        #progressbar #selfie:before {
                          font-family: FontAwesome;
                          content: "\f007";
                        }

                        #progressbar #fingerprint:before {
                          font-family: FontAwesome;
                          content: "\f09d";
                        }

                        #progressbar #confirm:before {
                          font-family: FontAwesome;
                          content: "\f00c";
                        }

                        /*ProgressBar before any progress*/
                        #progressbar li:before {
                          width: 50px;
                          height: 50px;
                          line-height: 45px;
                          display: block;
                          font-size: 18px;
                          color: #ffffff;
                          background: lightgray;
                          border-radius: 50%;
                          margin: 0 auto 10px auto;
                          padding: 2px;
                        }

                        /*ProgressBar connectors*/
                        #progressbar li:after {
                          content: "";
                          width: 100%;
                          height: 2px;
                          background: lightgray;
                          position: absolute;
                          left: 0;
                          top: 25px;
                          z-index: -1;
                        }

                        /*Color number of the step and the connector before it*/
                        #progressbar li.active:before,
                        #progressbar li.active:after {
                          background: skyblue;
                        }

                        /*Imaged Radio Buttons*/
                        .radio-group {
                          position: relative;
                          margin-bottom: 25px;
                        }

                        .radio {
                          display: inline-block;
                          width: 204;
                          height: 104;
                          border-radius: 0;
                          background: lightblue;
                          box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
                          box-sizing: border-box;
                          cursor: pointer;
                          margin: 8px 2px;
                        }

                        .radio:hover {
                          box-shadow: 2px 2px 2px 2px rgba(0, 0, 0, 0.3);
                        }

                        .radio.selected {
                          box-shadow: 1px 1px 2px 2px rgba(0, 0, 0, 0.1);
                        }

                        /*Fit image in bootstrap div*/
                        .fit-image {
                          width: 100%;
                          object-fit: cover;
                        }

                        #cameraContainer {
                          position: relative;
                          /* width: 300px; */
                          width: auto;
                          /* Adjust according to your layout */
                          /* height: 200px; */
                          height: auto;
                          /* Adjust according to your layout */
                        }

                        #videoFeed {
                          width: 100%;
                          height: 100%;
                          object-fit: cover;
                        }

                        .btn-sm {
                          font-size: 12px;
                        }

                        #captureButton {
                          position: absolute;
                          bottom: -24px;
                          left: 50%;
                          transform: translateX(-50%);
                          font-size: 13px;
                        }

                        .retake_btn {
                          display: flex;
                          justify-content: center;
                          align-content: center;
                        }

                        #retakebutton {
                          margin-right: 3px;
                        }

                        #next_step {
                          margin-left: 3px;
                        }

                        #loader {
                          position: fixed;
                          left: 0;
                          top: 0;
                          width: 100%;
                          height: 100%;
                          background-color: rgba(255, 255, 255, 0.8);
                          /* Semi-transparent background */
                          display: flex;
                          flex-direction: column;
                          align-items: center;
                          justify-content: center;
                          z-index: 9999;
                          /* Ensure it's on top of all other elements */
                        }

                        .spinner {
                          border: 16px solid #f3f3f3;
                          border-top: 16px solid #3498db;
                          border-radius: 50%;
                          width: 120px;
                          height: 120px;
                          animation: spin 2s linear infinite;
                        }

                        @keyframes spin {
                          0% {
                            transform: rotate(0deg);
                          }

                          100% {
                            transform: rotate(360deg);
                          }
                        }

                        #content {
                          /* Hide content until loader is removed */
                          display: none;
                        }

                        @media only screen and (max-width: 426px) {
                          .card h2 {
                            font-size: 20px;
                          }

                          .card p {
                            font-size: 12px;
                          }

                          .form-card h4 {
                            font-size: 20px;
                          }
                        }

                        @media only screen and (max-width: 376px) {
                          .card h2 {
                            font-size: 20px;
                          }

                          .card p {
                            font-size: 12px;
                          }

                          .form-card h4 {
                            font-size: 17px;
                          }
                        }

                        @media only screen and (max-width: 321px) {
                          .card h2 {
                            font-size: 20px;
                          }

                          .card p {
                            font-size: 10px;
                          }

                          .form-card h4 {
                            font-size: 14px;
                          }

                          #captureButton {
                            font-size: 11px;
                          }
                        }
                      </style>
                      <meta name="csrf-token" content="" />

                      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
                      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
                      <script src="{{ asset('assets/js/jquery.validate.min.js') }}"></script>
                    </head>

                    <body id="grad1">
                      <div id="loader">
                        <div class="spinner"></div>
                        <p>Loading..</p>
                      </div>
                      <!-- MultiStep Form -->
                      <div class="container-fluid" id="">
                        <div class="row justify-content-center mt-0">
                          <div
                            class="col-11 col-sm-9 col-md-7 col-lg-6 text-center p-0 mt-0 mb-0"
                          >
                            <div class="card px-0 pt-4 pb-0 mt-3 mb-3">
                              <h2><strong>Identity Verification</strong></h2>
                              <p>Please complete all steps to proceed.</p>
                              <div class="row">
                                <div class="col-md-12 mx-0">
                                  <style>
                                    .modal-backdrop {
                                      width: 0 !important;
                                    }

                                    .error {
                                      color: red;
                                    }

                                    #overlayCanvas {
                                      position: absolute;
                                      top: -5px !important;
                                      left: 0;
                                      width: 100%;
                                      height: 100%;
                                    }
                                  </style>
                                  <form id="msform">
                                    <ul id="progressbar">
                                      <li class="active" id="document">
                                        <strong>ID Card</strong>
                                      </li>
                                      <li id="document">
                                        <strong>ID Card</strong>
                                      </li>
                                      <li id="selfie">
                                        <strong>Selfie</strong>
                                      </li>

                                      <li id="confirm">
                                        <strong>Fingerprint</strong>
                                      </li>
                                    </ul>
                                    <fieldset>
                                      <div class="form-card">
                                        <h4>Front Side</h4>
                                        <p>
                                          Upload your ID Card front side.please
                                          make sure that the document should be
                                          clear and readable.
                                        </p>
                                        <div class="box_btn">
                                          <div id="cameraContainer">
                                            <video
                                              id="videoFeed"
                                              autoplay
                                              playsinline
                                            ></video>
                                            <canvas id="overlayCanvas"></canvas>
                                            <button
                                              id="captureButton"
                                              class="btn btn-primary btn-sm"
                                            >
                                              Capture Image
                                            </button>
                                          </div>
                                          <div
                                            class="previewContainer"
                                            id="previewContainer"
                                          ></div>
                                          <span
                                            class="error"
                                            style="color: red"
                                            id="error_cnic_document"
                                          ></span>
                                        </div>
                                        <div class="retake_btn">
                                          <button
                                            class="btn btn-danger btn-sm mt-2"
                                            style="display: none"
                                            id="retakebutton"
                                          >
                                            Retake
                                          </button>
                                          <button
                                            class="btn btn-primary btn-sm mt-2"
                                            style="display: none"
                                            id="next_step"
                                          >
                                            Next Step
                                          </button>
                                        </div>
                                      </div>
                                    </fieldset>
                                  </form>

                                  <div
                                    class="modal fade"
                                    id="documentVerification"
                                    tabindex="-1"
                                    role="dialog"
                                    aria-labelledby="modalLabel"
                                    aria-hidden="true"
                                    data-keyboard="false"
                                    data-backdrop="static"
                                  >
                                    <div
                                      class="modal-dialog modal-dialog modal-lg modal-dialog-mng"
                                    >
                                      <div
                                        class="modal-content modal-content-first"
                                      >
                                        <!-- Modal Header -->
                                        <div class="modal-header">
                                          <button
                                            type="button"
                                            class="close fa fa-times"
                                            data-dismiss="modal"
                                          ></button>
                                        </div>
                                        <!-- Modal body -->
                                        <div class="modal-body">
                                          <div class="row">
                                            <div class="col-12">
                                              <form
                                                id="saveDocumentForm"
                                                action=""
                                                method="post"
                                                enctype="multipart/form-data"
                                              >
                                                <input
                                                  type="hidden"
                                                  name="image_path"
                                                  id="image_path"
                                                />
                                                <input
                                                  type="hidden"
                                                  name="token"
                                                  value=""
                                                />

                                                <div class="modal-body">
                                                  <p>
                                                    If any mistakes occur while
                                                    reading your ID card, you
                                                    can make changes and click
                                                    the save button.
                                                  </p>
                                                  <div class="row mt-3">
                                                    <div class="col-6">
                                                      <div class="form-group">
                                                        <label
                                                          for="identity_name"
                                                          >Name</label
                                                        >
                                                        <input
                                                          type="text"
                                                          class="form-control"
                                                          name="identity_name"
                                                          id="identity_name"
                                                        />
                                                      </div>
                                                    </div>
                                                    <div class="col-6">
                                                      <div class="form-group">
                                                        <label for=""
                                                          >Father Name</label
                                                        >
                                                        <input
                                                          type="text"
                                                          class="form-control"
                                                          name="father_name"
                                                          id="father_name"
                                                        />
                                                      </div>
                                                    </div>
                                                  </div>
                                                  <div class="row mt-3">
                                                    <div class="col-6">
                                                      <div class="form-group">
                                                        <label for=""
                                                          >Identity
                                                          Number</label
                                                        >
                                                        <input
                                                          type="text"
                                                          class="form-control"
                                                          name="identity_number"
                                                          id="identity_number"
                                                        />
                                                      </div>
                                                    </div>
                                                    <div class="col-6">
                                                      <div class="form-group">
                                                        <label for=""
                                                          >Date of Birth
                                                          (dd-mm-yyyy)</label
                                                        >
                                                        <input
                                                          type="text"
                                                          class="form-control"
                                                          name="date_of_birth"
                                                          id="date_of_birth"
                                                        />
                                                      </div>
                                                    </div>
                                                  </div>
                                                  <div class="row mt-3">
                                                    <div class="col-6">
                                                      <div class="form-group">
                                                        <label for=""
                                                          >Card issuenes Date
                                                          (dd-mm-yyyy)</label
                                                        >
                                                        <input
                                                          type="text"
                                                          class="form-control"
                                                          name="card_issue_date"
                                                          id="card_issue_date"
                                                        />
                                                      </div>
                                                    </div>
                                                    <div class="col-6">
                                                      <div class="form-group">
                                                        <label for=""
                                                          >Card Expiry Date
                                                          (dd-mm-yyyy)</label
                                                        >
                                                        <input
                                                          type="text"
                                                          class="form-control"
                                                          name="card_expiry_date"
                                                          id="card_expiry_date"
                                                        />
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                                                <div
                                                  class="modal-footer"
                                                  style="
                                                    display: block;
                                                    padding-top: 20px;
                                                  "
                                                >
                                                  <button
                                                    type="button"
                                                    data-dismiss="modal"
                                                    class="btn btn-sm btn-danger"
                                                  >
                                                    Close
                                                  </button>
                                                  <button
                                                    type="submit"
                                                    class="btn btn-sm btn-success"
                                                  >
                                                    Next
                                                  </button>
                                                </div>
                                              </form>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div
                                    class="modal fade"
                                    id="missingDataAlert"
                                    data-bs-backdrop="static"
                                    data-bs-keyboard="false"
                                    tabindex="-1"
                                    role="dialog"
                                    aria-labelledby="modalLabel"
                                    aria-hidden="true"
                                    data-keyboard="false"
                                    data-backdrop="static"
                                  >
                                    <div
                                      class="modal-dialog modal-dialog modal-lg modal-dialog-mng"
                                    >
                                      <div
                                        class="modal-content modal-content-first"
                                      >
                                        <!-- Modal Header -->
                                        <div class="modal-header">
                                          <h5
                                            class="modal-title"
                                            id="modalLabel"
                                          >
                                            Missing Data Alert
                                          </h5>
                                          <!-- Modal title -->
                                          <button
                                            type="button"
                                            class="close fa fa-times"
                                            data-dismiss="modal"
                                          ></button>
                                        </div>
                                        <!-- Modal body -->
                                        <div class="modal-body">
                                          <p id="error_cnic_document_modal"></p>
                                        </div>
                                        <div class="modal-footer">
                                          <button
                                            type="button"
                                            class="btn btn-danger"
                                            data-dismiss="modal"
                                          >
                                            Ok
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>

                                  <script>
                                    const video =
                                      document.getElementById("videoFeed");
                                    const previewContainer =
                                      document.getElementById(
                                        "previewContainer"
                                      );

                                    const overlayCanvas =
                                      document.getElementById("overlayCanvas");
                                    const captureButton =
                                      document.getElementById("captureButton");
                                    const overlayCtx =
                                      overlayCanvas.getContext("2d");

                                    // Function to draw a box border on the overlay canvas
                                    function drawBox() {
                                      const frameWidth =
                                        video.videoWidth || 300; // Use video width if available, else fallback to 300
                                      const frameHeight =
                                        video.videoHeight || 200; // Use video height if available, else fallback to 200
                                      const boxWidth = frameWidth * 0.8; // 80% of frame width
                                      const boxHeight = frameHeight * 0.8; // 80% of frame height
                                      const borderRadius = 2; // Border radius

                                      const boxX = (frameWidth - boxWidth) / 2; // Calculate X position of the box
                                      const boxY =
                                        (frameHeight - boxHeight) / 2; // Calculate Y position of the box

                                      // Set the size of the overlay canvas
                                      overlayCanvas.width = frameWidth;
                                      overlayCanvas.height = frameHeight;

                                      // Clear the overlay canvas
                                      overlayCtx.clearRect(
                                        0,
                                        0,
                                        overlayCanvas.width,
                                        overlayCanvas.height
                                      );

                                      // Draw the rounded box on the overlay canvas
                                      overlayCtx.strokeStyle = "#008000";
                                      overlayCtx.lineWidth = 2;

                                      // Function to draw rounded rectangle
                                      drawRoundedRect(
                                        overlayCtx,
                                        boxX,
                                        boxY,
                                        boxWidth,
                                        boxHeight,
                                        borderRadius
                                      );
                                    }

                                    function drawRoundedRect(
                                      ctx,
                                      x,
                                      y,
                                      width,
                                      height,
                                      radius
                                    ) {
                                      ctx.beginPath();
                                      ctx.moveTo(x + radius, y);
                                      ctx.lineTo(x + width - radius, y);
                                      ctx.quadraticCurveTo(
                                        x + width,
                                        y,
                                        x + width,
                                        y + radius
                                      );
                                      ctx.lineTo(
                                        x + width,
                                        y + height - radius
                                      );
                                      ctx.quadraticCurveTo(
                                        x + width,
                                        y + height,
                                        x + width - radius,
                                        y + height
                                      );
                                      ctx.lineTo(x + radius, y + height);
                                      ctx.quadraticCurveTo(
                                        x,
                                        y + height,
                                        x,
                                        y + height - radius
                                      );
                                      ctx.lineTo(x, y + radius);
                                      ctx.quadraticCurveTo(x, y, x + radius, y);
                                      ctx.closePath();
                                      ctx.stroke();
                                    }

                                    // Call drawBox initially to show the box
                                    drawBox();

                                    // Add this line to redraw the box when the video dimensions are known
                                    video.addEventListener(
                                      "loadedmetadata",
                                      drawBox
                                    );

                                    async function initializeCamera() {
                                      try {
                                        const stream =
                                          await navigator.mediaDevices.getUserMedia(
                                            {
                                              video: {
                                                facingMode: "environment",
                                                width: { ideal: 4096 },
                                                height: { ideal: 2160 },
                                                frameRate: { ideal: 60 },
                                              },
                                            }
                                          );
                                        video.srcObject = stream;
                                        await video.play();
                                      } catch (error) {
                                        console.error(
                                          "Error accessing camera:",
                                          error
                                        );
                                      }
                                    }
                                    initializeCamera(); // 'environment' for back camera
                                    // Capture image when the button is clicked
                                    captureButton.addEventListener(
                                      "click",
                                      () => {
                                        captureImage();
                                        // Perform image capture logic here
                                      }
                                    );
                                    var captured_image;

                                    function captureImage() {
                                      $("#cameraContainer").hide();
                                      const canvas =
                                        document.createElement("canvas");

                                      // Use the highest resolution available from the video stream
                                      canvas.width = video.videoWidth;
                                      canvas.height = video.videoHeight;

                                      // Use a high-quality 2D rendering context
                                      const ctx = canvas.getContext("2d", {
                                        alpha: false,
                                        desynchronized: false,
                                        willReadFrequently: true,
                                      });

                                      // Apply image smoothing for better quality
                                      ctx.imageSmoothingEnabled = true;
                                      ctx.imageSmoothingQuality = "high";

                                      // Draw the video frame onto the canvas
                                      ctx.drawImage(
                                        video,
                                        0,
                                        0,
                                        canvas.width,
                                        canvas.height
                                      );

                                      // Apply a subtle sharpening filter
                                      applySharpening(
                                        ctx,
                                        canvas.width,
                                        canvas.height
                                      );

                                      // Get image data as base64 URL without compression
                                      const imageDataURL =
                                        canvas.toDataURL("image/png");
                                      const img = new Image();
                                      img.src = imageDataURL;
                                      captured_image = imageDataURL;

                                      // Display captured image preview
                                      previewContainer.innerHTML = "";
                                      previewContainer.appendChild(img);
                                      $("#previewContainer").show();
                                      $("#retakebutton").show();
                                      $("#next_step").show();
                                    }

                                    function applySharpening(
                                      ctx,
                                      width,
                                      height
                                    ) {
                                      const imageData = ctx.getImageData(
                                        0,
                                        0,
                                        width,
                                        height
                                      );
                                      const data = imageData.data;
                                      const factor = 0.5; // Adjust this value to control sharpening intensity

                                      for (let y = 1; y < height - 1; y++) {
                                        for (let x = 1; x < width - 1; x++) {
                                          const idx = (y * width + x) * 4;
                                          for (let c = 0; c < 3; c++) {
                                            const val =
                                              5 * data[idx + c] -
                                              data[idx - 4 + c] -
                                              data[idx + 4 + c] -
                                              data[idx - width * 4 + c] -
                                              data[idx + width * 4 + c];
                                            data[idx + c] = Math.min(
                                              255,
                                              Math.max(
                                                0,
                                                data[idx + c] +
                                                  factor * (val - data[idx + c])
                                              )
                                            );
                                          }
                                        }
                                      }

                                      ctx.putImageData(imageData, 0, 0);
                                    }
                                    $("#msform").on("submit", function (e) {
                                      e.preventDefault();
                                    });
                                    $("#retakebutton").on(
                                      "click",
                                      function (e) {
                                        e.preventDefault();
                                        $("#cameraContainer").show();
                                        $("#previewContainer").hide();
                                        $(this).hide();
                                        $("#next_step").hide();
                                        $("#error_cnic_document").text("");
                                      }
                                    );

                                    $("#next_step").on("click", function (e) {
                                      e.preventDefault();
                                      //return window.location.href = "{{ route('kyc.step2') }}";
                                      uploadDocumentFront();
                                    });

                                    $.validator.addMethod(
                                      "customDate",
                                      function (value, element) {
                                        // Check if the value matches the "d-m-Y" format using a regular expression
                                        return /^(0?[1-9]|[12][0-9]|3[01])-(0?[1-9]|1[012])-\d{4}$/.test(
                                          value
                                        );
                                      },
                                      "Please enter a valid date (dd-mm-yyyy)"
                                    );
                                    $("#saveDocumentForm").validate({
                                      rules: {
                                        identity_name: {
                                          required: true,
                                        },
                                        father_name: {
                                          required: true,
                                        },
                                        identity_number: {
                                          required: true,
                                          minlength: 13,
                                          maxlength: 13,
                                          number: true,
                                        },
                                        date_of_birth: {
                                          required: true,
                                          customDate: true,
                                        },
                                        card_issue_date: {
                                          required: true,
                                          customDate: true,
                                        },
                                        card_expiry_date: {
                                          required: true,
                                          customDate: true,
                                        },
                                      },
                                      messages: {
                                        date_of_birth: {
                                          dateISO:
                                            "Enter a valid date in format (1998-10-04).",
                                        },
                                        card_issue_date: {
                                          dateISO:
                                            "Enter a valid date in format (1998-10-04).",
                                        },
                                        card_expiry_date: {
                                          dateISO:
                                            "Enter a valid date in format (1998-10-04).",
                                        },

                                        identity_number: {
                                          number:
                                            "Put only numbers of your id card.",
                                          minlength:
                                            "The ID card number must be exactly 13 characters long.",
                                          maxlength:
                                            "The ID card number must be exactly 13 characters long.",
                                        },
                                      },
                                      errorPlacement: function (
                                        error,
                                        element
                                      ) {
                                        error.insertAfter(element);
                                        //   error.appendTo(element.parent());
                                      },
                                      submitHandler: function (form) {
                                        form.submit();
                                      },
                                    });
                                  </script>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <script>
                        $(document).ready(function () {
                          $(".submit").click(function () {
                            return false;
                          });
                          hideLoader();
                        });

                        function hideLoader() {
                          document.getElementById("loader").style.display =
                            "none";
                          document.getElementById("msform").style.display =
                            "block";
                        }

                        function showLoader() {
                          document.getElementById("loader").style.display =
                            "flex";
                          document.getElementById("msform").style.display =
                            "none";
                        }
                      </script>
                    </body>
                  </html>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
